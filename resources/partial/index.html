<progress-spinner ng:show="credentials === undefined"></progress-spinner>

<div ng:show="!!credentials">
  <div ng:show="credentials.length === 0">
    <br />
    <div class="alert alert-info">
      <i class="fa fa-info-circle"></i>
      <span translate="">There are no credentials to manage yet.</span>.
    </div>
  </div>
  <div ng:show="credentials.length > 0">
    <div class="input-group">
      <input ng:model="filter" type="search" autofocus class="form-control" placeholder="Filter" typeahead-min-length="1" />
      <div uib-dropdown class="input-group-btn">
        <button class="btn btn-default" uib-dropdown-toggle>
          <i class="fa fa-sort-amount-asc"></i> {{sort.name}}
          <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu-right" style="width: 150px">
          <li ng:repeat="sort in sorts">
            <a ng:click="sortClicked(sort)"> <i class="fa fa-sort-amount-asc"></i> {{sort.name}} </a>
          </li>
        </ul>
      </div>
      <div uib-dropdown class="input-group-btn" auto-close="outsideClick">
        <button class="btn btn-default" uib-dropdown-toggle>
          <i class="fa fa-list-ol"></i> {{'Rows'|translate}}
          <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu class="dropdown-menu-right" style="width: 200px">
          <li ng:repeat="size in [10, 50, 100, 500, 1000]">
            <a ng:click="paging.pageSize = size"><i class="fa fa-list-ol"></i> {{size}} <span translate>credentials</span></a>
          </li>
          <li>
            <div class="input-group" style="display: table">
              <div class="input-group-addon">Other:</div>
              <input ng:model="paging.pageSize" type="number" autofocus class="form-control" />
            </div>
          </li>
        </ul>
      </div>
    </div>
    <table class="table" ng:class="{'lmn-blurred': blurred}" style="width: 100%">
      <tr>
        <th width="30" class="text-center"><span translate> Class </span></th>
        <th width="120">Threema Username</th>
        <th width="120">ENT match</th>
        <th width="30"></th>
      </tr>
      <tr ng:repeat="cred in credentials|filter:filter|orderBy:sort.fx:reverse|page:paging.page:paging.pageSize">
        <td width="30" style="vertical-align: middle" class="text-center" ng:show="cred.cls !== '?'"><strong>{{cred.cls}}</strong></td>
        <td width="30" style="vertical-align: middle" class="text-center text-bold text-danger" ng:show="cred.cls === '?'">
          <i class="fa fa-question"></i>
        </td>
        <td width="120" style="vertical-align: middle" class="text-left">
          <i>{{cred.username}}</i>
        </td>
        <td width="120" style="vertical-align: middle" class="text-left">
          <span style="padding: 5px" ng:show="!cred.status">-</span>
          <span style="padding: 5px" ng:show="cred.status === 'OK'" class="text-success">OK</span>
          <span style="padding: 5px" ng:show="cred.status === 'UNMATCHED'" class="text-danger">No matching ENT record found</span>
          <button
            style="padding: 5px; border-radius: 5px; margin: 2px 0"
            ng:show="cred.status === 'SUGGESTION'"
            class="btn btn-info"
            ng-repeat="sugg in cred.suggestions"
            ng:click="openCredentialsChangeModal(cred.id, cred.username, sugg)"
          >
            <i class="fa fa-lightbulb"></i>&nbsp; {{sugg}}
          </button>
        </td>
        <td width="30" class="text-right" style="vertical-align: middle">
          <span uib-dropdown class="dropup">
            <button class="btn btn-default" uib-dropdown-toggle>
              <i class="fa fa-pen"></i>
              <span class="caret"></span>
            </button>
            <ul uib-dropdown-menu class="dropdown-menu-right" style="margin-bottom: -30px; margin-right: 40px; z-index: 4000">
              <li>
                <a ng:click="openCredentialsChangeModal(cred.id, cred.username, cred.username)" translate>Edit</a>
              </li>
              <li>
                <a ng:click="openCredentialsDeleteModal(cred.id, cred.username)" translate>Delete</a>
              </li>
            </ul>
          </span>
        </td>
      </tr>
    </table>

    <br />
    <ul
      uib-pagination
      ng:show="credentials.length > paging.pageSize"
      ng-model="paging.page"
      total-items="credentials.length"
      items-per-page="paging.pageSize"
      max-size="10"
      rotate="true"
      boundary-links="true"
    ></ul>

    <div style="margin-bottom: 30px">
      <button class="btn btn-primary" ng:click="validate()">Match against ENT</button>
      <a class="btn btn-warning" ng:show="countENTRecordsNotFoundInThreema" ng:href="./threema_connector/missing">
        Add missing ({{countENTRecordsNotFoundInThreema}})
      </a>
      <button class="btn btn-warning" ng:show="countSuggestionsForNameChange" ng:click="applyAllSuggestions()">
        Apply renaming suggestions ({{countSuggestionsForNameChange}})
      </button>
      <button class="btn btn-danger" ng:show="countThreemaRecordsNotFoundInENT" ng:click="deleteUnmatchedFromThreema()">
        Delete unmatched from Threema ({{countThreemaRecordsNotFoundInENT}})
      </button>
    </div>
  </div>
</div>
